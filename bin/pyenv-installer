#!/usr/bin/env bash

set -e
[ -n "$PYENV_DEBUG" ] && set -x

if [ -z "$PYENV_ROOT" ]; then
  PYENV_ROOT="${HOME}/.pyenv"
fi

checkout() {
  [ -d "$2" ] || git clone "$1" "$2"
}

if ! command -v git 1>/dev/null 2>&1; then
  echo "pyenv: Git is not installed, can't continue." 1>&2
  exit 1
fi

checkout "https://github.com/yyuu/pyenv.git"            "${PYENV_ROOT}"
checkout "https://github.com/yyuu/pyenv-doctor.git"     "${PYENV_ROOT}/plugins/pyenv-doctor"
checkout "https://github.com/yyuu/pyenv-installer.git"  "${PYENV_ROOT}/plugins/pyenv-installer"
checkout "https://github.com/yyuu/pyenv-pip-migrate.git" "${PYENV_ROOT}/plugins/pyenv-pip-migrate"
checkout "https://github.com/yyuu/pyenv-pip-rehash.git" "${PYENV_ROOT}/plugins/pyenv-pip-rehash"
checkout "https://github.com/yyuu/pyenv-update.git"     "${PYENV_ROOT}/plugins/pyenv-update"
checkout "https://github.com/yyuu/pyenv-version-ext.git" "${PYENV_ROOT}/plugins/pyenv-version-ext"
checkout "https://github.com/yyuu/pyenv-virtualenv.git" "${PYENV_ROOT}/plugins/pyenv-virtualenv"

if ! command -v pyenv 1>/dev/null 2>&1; then
  cat <<EOS
Seems you still have not added 'pyenv' to the load path:

export PYENV_ROOT="\${HOME}/.pyenv"

if [ -d "\${PYENV_ROOT}" ]; then
  export PATH="\${PYENV_ROOT}/bin:\${PATH}"
  eval "\$(pyenv init -)"
fi
EOS
fi
